
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="KServe Documentation" name="description"/>
<link href="https://kserve.io/website/local/modelserving/kafka/kafka/" rel="canonical"/>
<link href="../../../images/favicon/favicon-32x32.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-8.0.5" name="generator"/>
<title>Inference with Kafka event source - KServe Documentation Website</title>
<link href="../../../assets/stylesheets/main.a617204b.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.9204c3b2.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="none" data-md-color-primary="none" data-md-color-scheme="" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#end-to-end-inference-service-example-with-minio-and-kafka">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
<aside class="md-banner">
<div class="md-banner__inner md-grid md-typeset">
<h1>
<b>KServe v0.9 is Released</b>, <a href="/website/0.9/blog/articles/2022-07-21-KServe-0.9-release/">Read blog &gt;&gt;</a>
</h1>
</div>
</aside>
</div>
<div data-md-component="outdated" hidden="">
<aside class="md-banner md-banner--warning">
</aside>
</div>
<header class="md-header md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="KServe Documentation Website" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="KServe Documentation Website">
<img alt="logo" src="../../../images/logo/kserve.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            KServe Documentation Website
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Inference with Kafka event source
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/kserve/website" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../get_started/">
        Getting started
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../admin/serverless/serverless/">
        Administration Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../control_plane/">
        User Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../reference/api/">
        API Reference
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../developer/developer/">
        Developer Guide
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../blog/articles/2022-07-21-KServe-0.9-release/">
        Blog
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../community/adopters/">
        Community
      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="KServe Documentation Website" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="KServe Documentation Website">
<img alt="logo" src="../../../images/logo/kserve.png"/>
</a>
    KServe Documentation Website
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/kserve/website" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
          Getting started
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Getting started" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Getting started
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/">
        KServe Quickstart
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/first_isvc/">
        First InferenceService
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../get_started/swagger_ui/">
        Interact with InferenceService Swagger UI
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3">
          Administration Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Administration Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Administration Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" id="__nav_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1">
          Install KServe
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Install KServe" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_1">
<span class="md-nav__icon md-icon"></span>
          Install KServe
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_1" id="__nav_3_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_1_1">
          Serverless
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Serverless" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_1_1">
<span class="md-nav__icon md-icon"></span>
          Serverless
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/serverless/">
        Serverless installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/servicemesh/">
        Istio Service Mesh
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/serverless/kourier_networking/">
        Kourier Networking Layer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/modelmesh/">
        ModelMesh installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/kubernetes_deployment/">
        Kubernetes deployment installation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../admin/migration/">
        Migrating from KFServing
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4">
          User Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="User Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" id="__nav_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1">
          Concepts
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Concepts" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_1">
<span class="md-nav__icon md-icon"></span>
          Concepts
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_1" id="__nav_4_1_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_1">
          Control Plane
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Control Plane" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_1">
<span class="md-nav__icon md-icon"></span>
          Control Plane
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../control_plane/">
        Model Serving Control Plane
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_2" id="__nav_4_1_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_1_2">
          Data Plane
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Data Plane" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_1_2">
<span class="md-nav__icon md-icon"></span>
          Data Plane
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../data_plane/">
        Model Serving Data Plane
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../inference_api/">
        V2 Inference Protocol
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../servingruntimes/">
        Serving Runtimes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2">
          Single Model Serving
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Single Model Serving" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          Single Model Serving
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_1" id="__nav_4_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_1">
          Supported Model Frameworks/Formats
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Supported Model Frameworks/Formats" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_1">
<span class="md-nav__icon md-icon"></span>
          Supported Model Frameworks/Formats
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/serving_runtime/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/tensorflow/">
        Tensorflow
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/torchserve/">
        PyTorch
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/sklearn/v2/">
        Scikit-learn
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/xgboost/">
        XGBoost
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/pmml/">
        PMML
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/spark/">
        Spark MLlib
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/lightgbm/">
        LightGBM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/paddle/">
        Paddle
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/mlflow/v2/">
        MLFlow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_2" id="__nav_4_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2">
          Multi-Framework Serving Runtimes
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Multi-Framework Serving Runtimes" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_2_2">
<span class="md-nav__icon md-icon"></span>
          Multi-Framework Serving Runtimes
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_2_1" id="__nav_4_2_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2_2_1">
          Nvidia Triton
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Nvidia Triton" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_4_2_2_1">
<span class="md-nav__icon md-icon"></span>
          Nvidia Triton
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/triton/torchscript/">
        Torchscript
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/triton/bert/">
        Tensorflow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/amd/">
        AMD
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/custom/custom_model/">
        How to write a custom predictor
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3">
          Multi Model Serving
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Multi Model Serving" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Multi Model Serving
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3_1" id="__nav_4_3_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3_1">
          Overview
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Overview" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_3_1">
<span class="md-nav__icon md-icon"></span>
          Overview
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../mms/multi-model-serving/">
        The Scalability Problem
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mms/modelmesh/overview/">
        ModelMesh Overview
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4">
          Transformers
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Transformers" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          Transformers
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/transformer/feast/">
        Feast
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/transformer/torchserve_image_transformer/">
        How to write a custom transformer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5">
          Inference Graph
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Inference Graph" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          Inference Graph
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../inference_graph/">
        Concept
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../inference_graph/image_pipeline/">
        Image classification inference graph
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6">
          Model Storage
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Storage" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          Model Storage
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../storage/azure/azure/">
        Azure
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../storage/pvc/pvc/">
        PVC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../storage/s3/s3/">
        S3
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../storage/uri/uri/">
        URI
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7" id="__nav_4_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7">
          Model Explainability
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Explainability" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
          Model Explainability
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../explainer/explainer/">
        Concept
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_7_2" id="__nav_4_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7_2">
          Alibi Explainer
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Alibi Explainer" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_4_7_2">
<span class="md-nav__icon md-icon"></span>
          Alibi Explainer
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../explainer/alibi/cifar10/">
        Image Explainer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../explainer/alibi/income/">
        Income Explainer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../explainer/alibi/moviesentiment/">
        Text Explainer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../explainer/aix/mnist/aix/">
        AIX Explainer
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_8" id="__nav_4_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_8">
          Model Monitoring
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Model Monitoring" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_8">
<span class="md-nav__icon md-icon"></span>
          Model Monitoring
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../detect/alibi_detect/alibi_detect/">
        Alibi Detector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../detect/aif/germancredit/">
        AIF Bias Detector
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../detect/art/mnist/">
        ART Adversarial Detector
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_9" id="__nav_4_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_9">
          Request Batching
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Request Batching" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_9">
<span class="md-nav__icon md-icon"></span>
          Request Batching
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../batcher/batcher/">
        Inference Batcher
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_10" id="__nav_4_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_10">
          Payload Logging
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Payload Logging" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_10">
<span class="md-nav__icon md-icon"></span>
          Payload Logging
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../logger/logger/">
        Inference Logger
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_11" id="__nav_4_11" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_11">
          Autoscaling
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Autoscaling" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_11">
<span class="md-nav__icon md-icon"></span>
          Autoscaling
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../autoscaling/autoscaling/">
        Inference Autoscaling
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_12" id="__nav_4_12" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_12">
          Node Scheduling
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Node Scheduling" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_12">
<span class="md-nav__icon md-icon"></span>
          Node Scheduling
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../nodescheduling/overview/">
        Overview
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../nodescheduling/inferenceservicenodescheduling/">
        InferenceService Node Scheduling
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_13" id="__nav_4_13" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_13">
          Kafka
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Kafka" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_13">
<span class="md-nav__icon md-icon"></span>
          Kafka
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Inference with Kafka event source
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Inference with Kafka event source
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy-kafka">
    Deploy Kafka
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#install-knative-eventing-and-kafka-event-source">
    Install Knative Eventing and Kafka Event Source
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy-minio">
    Deploy Minio
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-the-mnist-model-to-minio">
    Upload the mnist model to Minio
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-s3-secret-for-minio-and-attach-to-service-account">
    Create S3 Secret for Minio and attach to Service Account
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#build-mnist-transformer-image">
    Build mnist transformer image
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-the-inferenceservice">
    Create the InferenceService
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-kafka-event-source">
    Create kafka event source
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-a-digit-image-to-minio-mnist-bucket">
    Upload a digit image to Minio mnist bucket
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_14" id="__nav_4_14" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_14">
          Rollout Strategies
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Rollout Strategies" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_14">
<span class="md-nav__icon md-icon"></span>
          Rollout Strategies
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/rollout/canary/">
        Canary
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../v1beta1/rollout/canary-example/">
        Canary Example
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5">
          API Reference
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="API Reference" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/api/">
        Control Plane API
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../reference/swagger-ui/">
        Control Plane swagger-ui
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../sdk_docs/sdk_doc/">
        Python Client SDK
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Developer Guide" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../developer/developer/">
        How to contribute
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../developer/debug/">
        Debugging guide
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7">
          Blog
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
          Blog
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" id="__nav_7_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_1">
          Releases
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Releases" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_1">
<span class="md-nav__icon md-icon"></span>
          Releases
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2022-07-21-KServe-0.9-release/">
        KServe 0.9 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2022-02-18-KServe-0.8-release/">
        KServe 0.8 Release
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2021-10-11-KServe-0.7-release/">
        KServe 0.7 Release
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" id="__nav_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_7_2">
          Articles
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Articles" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_7_2">
<span class="md-nav__icon md-icon"></span>
          Articles
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../blog/articles/2021-09-27-kfserving-transition/">
        KFserving Transition
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8">
          Community
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Community" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
          Community
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../community/adopters/">
        Adopters
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../community/presentations/">
        Demos and Presentations
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy-kafka">
    Deploy Kafka
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#install-knative-eventing-and-kafka-event-source">
    Install Knative Eventing and Kafka Event Source
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#deploy-minio">
    Deploy Minio
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-the-mnist-model-to-minio">
    Upload the mnist model to Minio
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-s3-secret-for-minio-and-attach-to-service-account">
    Create S3 Secret for Minio and attach to Service Account
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#build-mnist-transformer-image">
    Build mnist transformer image
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-the-inferenceservice">
    Create the InferenceService
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#create-kafka-event-source">
    Create kafka event source
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#upload-a-digit-image-to-minio-mnist-bucket">
    Upload a digit image to Minio mnist bucket
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/kserve/website/edit/main/docs/modelserving/kafka/kafka.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="end-to-end-inference-service-example-with-minio-and-kafka">End to end inference service example with Minio and Kafka<a class="headerlink" href="#end-to-end-inference-service-example-with-minio-and-kafka" title="Permanent link">¶</a></h1>
<p>This example shows an end to end inference pipeline which processes an kafka event and invoke the inference service to get the prediction with provided pre/post processing code.</p>
<p><img alt="diagram" src="../images/diagram.png"/></p>
<h2 id="deploy-kafka">Deploy Kafka<a class="headerlink" href="#deploy-kafka" title="Permanent link">¶</a></h2>
<p>If you do not have an existing kafka cluster, you can run the following commands to install in-cluster kafka using <a href="https://helm.sh">helm3</a> with persistence turned off.</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>confluentinc<span class="w"> </span>https://confluentinc.github.io/cp-helm-charts/
helm<span class="w"> </span>repo<span class="w"> </span>update
helm<span class="w"> </span>install<span class="w"> </span>my-kafka<span class="w"> </span>-f<span class="w"> </span>values.yaml<span class="w"> </span>--set<span class="w"> </span>cp-schema-registry.enabled<span class="o">=</span>false,cp-kafka-rest.enabled<span class="o">=</span>false,cp-kafka-connect.enabled<span class="o">=</span><span class="nb">false</span><span class="w"> </span>confluentinc/cp-helm-charts
</code></pre></div>
<p>after successful install you are expected to see the running kafka cluster
<div class="highlight"><pre><span></span><code>NAME<span class="w">                      </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
my-kafka-cp-kafka-0<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>126m
my-kafka-cp-kafka-1<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">1</span><span class="w">          </span>126m
my-kafka-cp-kafka-2<span class="w">       </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>126m
my-kafka-cp-zookeeper-0<span class="w">   </span><span class="m">2</span>/2<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>127m
</code></pre></div></p>
<h2 id="install-knative-eventing-and-kafka-event-source">Install Knative Eventing and Kafka Event Source<a class="headerlink" href="#install-knative-eventing-and-kafka-event-source" title="Permanent link">¶</a></h2>
<ul>
<li>Install <a href="https://knative.dev/docs/admin/install/eventing/install-eventing-with-yaml/">Knative Eventing Core &gt;= 0.18</a>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/knative/eventing/releases/download/v0.25.0/eventing-crds.yaml
kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/knative/eventing/releases/download/v0.25.0/eventing-core.yaml
</code></pre></div></li>
<li>Install <a href="https://github.com/knative-sandbox/eventing-kafka/releases">Kafka Event Source</a>.
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/knative-sandbox/eventing-kafka/releases/download/v0.25.3/source.yaml
</code></pre></div></li>
<li>Install <code>InferenceService</code> addressable cluster role
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>addressable-resolver.yaml
</code></pre></div></li>
</ul>
<h2 id="deploy-minio">Deploy Minio<a class="headerlink" href="#deploy-minio" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>If you do not have Minio setup in your cluster, you can run following command to install Minio test instance.
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>minio.yaml
</code></pre></div></p>
</li>
<li>
<p>Install Minio client <a href="https://docs.min.io/docs/minio-client-complete-guide">mc</a>
<div class="highlight"><pre><span></span><code><span class="c1"># Run port forwarding command in a different terminal</span>
kubectl<span class="w"> </span>port-forward<span class="w"> </span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>--selector<span class="o">=</span><span class="s2">"app=minio"</span><span class="w"> </span>--output<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">'{.items[0].metadata.name}'</span><span class="k">)</span><span class="w"> </span><span class="m">9000</span>:9000

mc<span class="w"> </span>config<span class="w"> </span>host<span class="w"> </span>add<span class="w"> </span>myminio<span class="w"> </span>http://127.0.0.1:9000<span class="w"> </span>minio<span class="w"> </span>minio123
</code></pre></div></p>
</li>
<li>
<p>Create buckets <code>mnist</code> for uploading images and <code>digit-[0-9]</code> for classification.
<div class="highlight"><pre><span></span><code>mc<span class="w"> </span>mb<span class="w"> </span>myminio/mnist
mc<span class="w"> </span>mb<span class="w"> </span>myminio/digit-<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span>
</code></pre></div></p>
</li>
<li>
<p>Setup event notification to publish events to kafka.
<div class="highlight"><pre><span></span><code><span class="c1"># Setup bucket event notification with kafka</span>
mc<span class="w"> </span>admin<span class="w"> </span>config<span class="w"> </span><span class="nb">set</span><span class="w"> </span>myminio<span class="w"> </span>notify_kafka:1<span class="w"> </span><span class="nv">tls_skip_verify</span><span class="o">=</span><span class="s2">"off"</span><span class="w">  </span><span class="nv">queue_dir</span><span class="o">=</span><span class="s2">""</span><span class="w"> </span><span class="nv">queue_limit</span><span class="o">=</span><span class="s2">"0"</span><span class="w"> </span><span class="nv">sasl</span><span class="o">=</span><span class="s2">"off"</span><span class="w"> </span><span class="nv">sasl_password</span><span class="o">=</span><span class="s2">""</span><span class="w"> </span><span class="nv">sasl_username</span><span class="o">=</span><span class="s2">""</span><span class="w"> </span><span class="nv">tls_client_auth</span><span class="o">=</span><span class="s2">"0"</span><span class="w"> </span><span class="nv">tls</span><span class="o">=</span><span class="s2">"off"</span><span class="w"> </span><span class="nv">client_tls_cert</span><span class="o">=</span><span class="s2">""</span><span class="w"> </span><span class="nv">client_tls_key</span><span class="o">=</span><span class="s2">""</span><span class="w"> </span><span class="nv">brokers</span><span class="o">=</span><span class="s2">"my-kafka-cp-kafka-headless:9092"</span><span class="w"> </span><span class="nv">topic</span><span class="o">=</span><span class="s2">"mnist"</span><span class="w"> </span><span class="nv">version</span><span class="o">=</span><span class="s2">""</span>

<span class="c1"># Restart minio</span>
mc<span class="w"> </span>admin<span class="w"> </span>service<span class="w"> </span>restart<span class="w"> </span>myminio

<span class="c1"># Setup event notification when putting images to the bucket</span>
mc<span class="w"> </span>event<span class="w"> </span>add<span class="w"> </span>myminio/mnist<span class="w"> </span>arn:minio:sqs::1:kafka<span class="w"> </span>-p<span class="w"> </span>--event<span class="w"> </span>put<span class="w"> </span>--suffix<span class="w"> </span>.png
</code></pre></div></p>
</li>
</ul>
<h2 id="upload-the-mnist-model-to-minio">Upload the mnist model to Minio<a class="headerlink" href="#upload-the-mnist-model-to-minio" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code>gsutil cp -r gs://kfserving-examples/models/tensorflow/mnist .
mc cp -r mnist myminio/
</code></pre></div>
<h2 id="create-s3-secret-for-minio-and-attach-to-service-account">Create S3 Secret for Minio and attach to Service Account<a class="headerlink" href="#create-s3-secret-for-minio-and-attach-to-service-account" title="Permanent link">¶</a></h2>
<p><code>KServe</code> gets the secrets from your service account, you need to add the created or existing secret to your service account's secret list. 
By default <code>KServe</code> uses <code>default</code> service account, user can use own service account and overwrite on <code>InferenceService</code> CRD.</p>
<p>Apply the secret and attach the secret to the service account.
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>s3-secret.yaml
</code></pre></div></p>
<h2 id="build-mnist-transformer-image">Build mnist transformer image<a class="headerlink" href="#build-mnist-transformer-image" title="Permanent link">¶</a></h2>
<p>The transformation image implements the preprocess handler to process the minio notification event to download the image from minio and transform image bytes to tensors. The postprocess handler processes the prediction and upload the image to the classified minio bucket <code>digit-[0-9]</code>.
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span><span class="nv">$USER</span>/mnist-transformer:latest<span class="w"> </span>-f<span class="w"> </span>./transformer.Dockerfile<span class="w"> </span>.<span class="w"> </span>--rm
docker<span class="w"> </span>push<span class="w"> </span><span class="nv">$USER</span>/mnist-transformer:latest
</code></pre></div></p>
<h2 id="create-the-inferenceservice">Create the InferenceService<a class="headerlink" href="#create-the-inferenceservice" title="Permanent link">¶</a></h2>
<p>Specify the built image on <code>Transformer</code> spec and apply the inference service CRD.
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>mnist-kafka.yaml<span class="w"> </span>
</code></pre></div></p>
<p>This creates transformer and predictor pods, the request goes to transformer first where it invokes the preprocess handler, transformer then calls out to predictor to get the prediction response which in turn invokes the postprocess handler. 
<div class="highlight"><pre><span></span><code>kubectl get pods -l serving.kserve.io/inferenceservice=mnist
mnist-predictor-default-9t5ms-deployment-74f5cd7767-khthf     2/2     Running       0          10s
mnist-transformer-default-jmf98-deployment-8585cbc748-ftfhd   2/2     Running       0          14m
</code></pre></div></p>
<h2 id="create-kafka-event-source">Create kafka event source<a class="headerlink" href="#create-kafka-event-source" title="Permanent link">¶</a></h2>
<p>Apply kafka event source which creates the kafka consumer pod to pull the events from kafka and deliver to inference service.
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>kafka-source.yaml
</code></pre></div></p>
<p>This creates the kafka source pod which consumers the events from <code>mnist</code> topic
<div class="highlight"><pre><span></span><code>kafkasource-kafka-source-3d809fe2-1267-11ea-99d0-42010af00zbn5h<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>8h
</code></pre></div></p>
<h2 id="upload-a-digit-image-to-minio-mnist-bucket">Upload a digit image to Minio mnist bucket<a class="headerlink" href="#upload-a-digit-image-to-minio-mnist-bucket" title="Permanent link">¶</a></h2>
<p>The last step is to upload the image <code>images/0.png</code>, image then should be moved to the classified bucket based on the prediction response!
<div class="highlight"><pre><span></span><code>mc<span class="w"> </span>cp<span class="w"> </span>images/0.png<span class="w"> </span>myminio/mnist
</code></pre></div>
you should expect a notification event like following sent to kafka topic <code>mnist</code> after uploading an image in <code>mnist</code> bucket
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">   </span><span class="nt">"EventType"</span><span class="p">:</span><span class="s2">"s3:ObjectCreated:Put"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"Key"</span><span class="p">:</span><span class="s2">"mnist/0.png"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"Records"</span><span class="p">:[</span>
<span class="w">      </span><span class="p">{</span><span class="nt">"eventVersion"</span><span class="p">:</span><span class="s2">"2.0"</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"eventSource"</span><span class="p">:</span><span class="s2">"minio:s3"</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"awsRegion"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"eventTime"</span><span class="p">:</span><span class="s2">"2019-11-17T19:08:08Z"</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"eventName"</span><span class="p">:</span><span class="s2">"s3:ObjectCreated:Put"</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"userIdentity"</span><span class="p">:{</span><span class="nt">"principalId"</span><span class="p">:</span><span class="s2">"minio"</span><span class="p">},</span>
<span class="w">       </span><span class="nt">"requestParameters"</span><span class="p">:{</span><span class="nt">"sourceIPAddress"</span><span class="p">:</span><span class="s2">"127.0.0.1:37830"</span><span class="p">},</span>
<span class="w">       </span><span class="nt">"responseElements"</span><span class="p">:{</span><span class="nt">"x-amz-request-id"</span><span class="p">:</span><span class="s2">"15D808BF706E0994"</span><span class="p">,</span>
<span class="w">       </span><span class="nt">"x-minio-origin-endpoint"</span><span class="p">:</span><span class="s2">"http://10.244.0.71:9000"</span><span class="p">},</span>
<span class="w">       </span><span class="nt">"s3"</span><span class="p">:{</span>
<span class="w">          </span><span class="nt">"s3SchemaVersion"</span><span class="p">:</span><span class="s2">"1.0"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"configurationId"</span><span class="p">:</span><span class="s2">"Config"</span><span class="p">,</span>
<span class="w">          </span><span class="nt">"bucket"</span><span class="p">:{</span>
<span class="w">               </span><span class="nt">"name"</span><span class="p">:</span><span class="s2">"mnist"</span><span class="p">,</span>
<span class="w">               </span><span class="nt">"ownerIdentity"</span><span class="p">:{</span><span class="nt">"principalId"</span><span class="p">:</span><span class="s2">"minio"</span><span class="p">},</span>
<span class="w">               </span><span class="nt">"arn"</span><span class="p">:</span><span class="s2">"arn:aws:s3:::mnist"</span><span class="p">},</span>
<span class="w">          </span><span class="nt">"object"</span><span class="p">:{</span><span class="nt">"key"</span><span class="p">:</span><span class="s2">"0.png"</span><span class="p">,</span><span class="nt">"size"</span><span class="p">:</span><span class="mi">324</span><span class="p">,</span><span class="nt">"eTag"</span><span class="p">:</span><span class="s2">"ebed21f6f77b0a64673a3c96b0c623ba"</span><span class="p">,</span><span class="nt">"contentType"</span><span class="p">:</span><span class="s2">"image/png"</span><span class="p">,</span><span class="nt">"userMetadata"</span><span class="p">:{</span><span class="nt">"content-type"</span><span class="p">:</span><span class="s2">"image/png"</span><span class="p">},</span><span class="nt">"versionId"</span><span class="p">:</span><span class="s2">"1"</span><span class="p">,</span><span class="nt">"sequencer"</span><span class="p">:</span><span class="s2">"15D808BF706E0994"</span><span class="p">}},</span>
<span class="w">          </span><span class="nt">"source"</span><span class="p">:{</span><span class="nt">"host"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nt">"port"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span><span class="nt">"userAgent"</span><span class="p">:</span><span class="s2">""</span><span class="p">}}</span>
<span class="w">   </span><span class="p">],</span>
<span class="w">   </span><span class="nt">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"msg"</span><span class="p">:</span><span class="s2">""</span><span class="p">,</span>
<span class="w">   </span><span class="nt">"time"</span><span class="p">:</span><span class="s2">"2019-11-17T19:08:08Z"</span>
<span class="p">}</span>
</code></pre></div></p>
<p>Check the transformer log, you should expect a prediction response and put the image to the corresponding bucket
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>logs<span class="w"> </span>mnist-transformer-default-rctjm-deployment-54d59c849c-2dq98<span class="w">  </span>kserve-container
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:27<span class="w"> </span>kfserver:88<span class="o">]</span><span class="w"> </span>Registering<span class="w"> </span>model:<span class="w"> </span>mnist
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:27<span class="w"> </span>kfserver:77<span class="o">]</span><span class="w"> </span>Listening<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">8080</span>
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:27<span class="w"> </span>kfserver:79<span class="o">]</span><span class="w"> </span>Will<span class="w"> </span>fork<span class="w"> </span><span class="m">0</span><span class="w"> </span>workers
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:27<span class="w"> </span>process:123<span class="o">]</span><span class="w"> </span>Starting<span class="w"> </span><span class="m">6</span><span class="w"> </span>processes
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:44<span class="w"> </span>connectionpool:203<span class="o">]</span><span class="w"> </span>Starting<span class="w"> </span>new<span class="w"> </span>HTTP<span class="w"> </span>connection<span class="w"> </span><span class="o">(</span><span class="m">1</span><span class="o">)</span>:<span class="w"> </span>minio-service
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:58<span class="w"> </span>image_transformer:51<span class="o">]</span><span class="w"> </span><span class="o">{</span><span class="s1">'predictions'</span>:<span class="w"> </span><span class="o">[{</span><span class="s1">'predictions'</span>:<span class="w"> </span><span class="o">[</span><span class="m">0</span>.0247901566,<span class="w"> </span><span class="m">1</span>.37231364e-05,<span class="w"> </span><span class="m">0</span>.0202635303,<span class="w"> </span><span class="m">0</span>.39037028,<span class="w"> </span><span class="m">0</span>.000513458275,<span class="w"> </span><span class="m">0</span>.435112566,<span class="w"> </span><span class="m">0</span>.000607515569,<span class="w"> </span><span class="m">0</span>.00041125578,<span class="w"> </span><span class="m">0</span>.127784252,<span class="w"> </span><span class="m">0</span>.000133168287<span class="o">]</span>,<span class="w"> </span><span class="s1">'classes'</span>:<span class="w"> </span><span class="m">5</span><span class="o">}]}</span>
<span class="o">[</span>I<span class="w"> </span><span class="m">201128</span><span class="w"> </span><span class="m">22</span>:32:58<span class="w"> </span>image_transformer:53<span class="o">]</span><span class="w"> </span>digit:5
</code></pre></div></p>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: InferenceService Node Scheduling" class="md-footer__link md-footer__link--prev" href="../../nodescheduling/inferenceservicenodescheduling/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              InferenceService Node Scheduling
            </div>
</div>
</a>
<a aria-label="Next: Canary" class="md-footer__link md-footer__link--next" href="../../v1beta1/rollout/canary/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Canary
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2021 The KServe Authors
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/kserve" rel="noopener" target="_blank" title="KServe Community on Github">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://kubeflow.slack.com/join/shared_invite/zt-n73pfj05-l206djXlXk5qdQKs4o1Zkg#" rel="noopener" target="_blank" title="Slack">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tracking", "navigation.tabs.sticky", "navigation.top"], "search": "../../../assets/javascripts/workers/search.cefbb252.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
<script src="../../../assets/javascripts/bundle.a5f8ea78.min.js"></script>
</body>
</html>